<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>üíÄ Skull Arena ‚Äì Battle Pass</title>
<style>
/* --- ANIMATIONS --- */
@keyframes glowText { 0%,100%{text-shadow:0 0 10px #ff0055,0 0 20px #ff0055} 50%{text-shadow:0 0 20px #ff0055,0 0 40px #ff0055} }
@keyframes bgScroll { 0%{background-position:0 0} 100%{background-position:40px 40px} }
@keyframes shine { 0%{left:-100%} 100%{left:100%} }

/* --- GLOBAL --- */
html,body{margin:0;padding:0;background:#050505;color:#fff;font-family:'Segoe UI',Impact,sans-serif;overflow:hidden;user-select:none}
canvas{display:block}

/* --- VARIABLES --- */
:root{
  --primary: #ff0055;
  --secondary: #ffd700;
  --dark: #0a0a12;
  --pass-bg: #1a1a24;
  --pass-item: #252530;
  --unlock: #00ff88;
}

/* --- INTERFACE --- */
.panel{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.85);z-index:10;backdrop-filter:blur(5px)}

/* BOITES STYLIS√âES */
.box-style {
    position: relative;
    width: 450px;
    padding: 30px;
    background: var(--dark);
    border: 2px solid var(--primary);
    box-shadow: 0 0 30px rgba(255, 0, 85, 0.3), inset 0 0 50px rgba(0,0,0,0.8);
    text-align: center;
    clip-path: polygon(0 0, 100% 0, 100% 90%, 90% 100%, 0 100%);
    display: flex; flex-direction: column; gap: 15px;
}

.box-style::before {
    content:''; position:absolute; inset:0; z-index:-1;
    background-image: linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
    background-size: 20px 20px;
    animation: bgScroll 10s linear infinite;
}

h1 { font-size: 56px; color: #fff; animation: glowText 2s infinite; margin: 0 0 10px; text-transform:uppercase; font-style:italic; letter-spacing:-2px; }
h2 { color: var(--secondary); font-size: 28px; margin: 0; text-transform:uppercase; }

.skull-count { color: var(--secondary); font-size: 24px; font-weight:bold; }

/* BOUTONS */
.btn {
    width: 100%; padding: 15px;
    background: transparent; border: 2px solid var(--primary);
    color: #fff; font-size: 18px; font-weight: 800; text-transform: uppercase;
    cursor: pointer; transition: 0.2s; position: relative; overflow: hidden;
}
.btn:hover { background: var(--primary); color: #000; box-shadow: 0 0 20px var(--primary); transform: scale(1.02); }
.btn.secondary { border-color: #555; color: #ccc; }
.btn.secondary:hover { background: #ccc; border-color: #ccc; box-shadow: 0 0 20px #ccc; color:#000; }
.btn.gold { border-color: var(--secondary); color: var(--secondary); }
.btn.gold:hover { background: var(--secondary); color:#000; box-shadow: 0 0 20px var(--secondary); }

/* BATTLE PASS STYLE (Clash Royale vibe) */
#passMenu .box-style { width: 500px; height: 80vh; padding: 20px; }
.pass-header { flex-shrink: 0; border-bottom: 1px solid #333; padding-bottom: 15px; margin-bottom: 10px; }

.pass-list {
    flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column-reverse; /* Progression vers le haut */
    gap: 15px; padding-right: 10px;
    scrollbar-width: thin; scrollbar-color: var(--primary) #000;
}

.pass-row {
    background: var(--pass-item); border-radius: 10px; padding: 15px;
    display: flex; align-items: center; justify-content: space-between;
    border: 1px solid #333; position: relative;
    transition: 0.3s;
}

.pass-row.locked { opacity: 0.5; filter: grayscale(1); }
.pass-row.unlocked { border-color: var(--secondary); background: linear-gradient(90deg, #1a1a24, #2a2a00); }
.pass-row.claimed { border-color: var(--unlock); opacity: 0.8; }

.tier-badge {
    background: #000; width: 40px; height: 40px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-weight: bold; border: 2px solid #555; margin-right: 10px; font-size: 14px;
}
.unlocked .tier-badge { border-color: var(--secondary); color: var(--secondary); }

.pass-info { flex-grow: 1; text-align: left; }
.pass-wave { font-size: 12px; color: #aaa; text-transform: uppercase; letter-spacing: 1px; }
.pass-reward { font-size: 18px; color: var(--secondary); font-weight: bold; display: flex; align-items: center; gap: 5px; }

.claim-btn {
    padding: 8px 15px; font-weight: bold; border: none; border-radius: 5px; cursor: pointer; text-transform: uppercase; font-size: 12px;
}
.claim-btn.lock { background: #333; color: #777; cursor: not-allowed; }
.claim-btn.ready { background: linear-gradient(135deg, #ffd700, #ffaa00); color: #000; box-shadow: 0 0 10px var(--secondary); animation: pulseBtn 1s infinite alternate; }
.claim-btn.done { background: #00ff88; color: #000; cursor: default; }

@keyframes pulseBtn { 0%{transform:scale(1)} 100%{transform:scale(1.05)} }

/* HUD */
#hud{position:fixed;top:20px;left:20px;pointer-events:none;z-index:5}
.hud-item {
    background: rgba(0,0,0,0.6); padding: 10px 20px;
    border-left: 4px solid var(--primary); margin-bottom: 5px;
    color: #fff; font-weight: bold; font-size: 18px;
    display: flex; align-items: center; gap: 10px;
}
.bar-cont { width: 150px; height: 12px; background: #333; position: relative; transform: skewX(-20deg); border: 1px solid #555; }
#hpBar { height: 100%; background: linear-gradient(90deg, #f00, #ff5555); width: 100%; transition: width 0.2s; box-shadow: 0 0 10px #f00; }

/* SHOP */
.shopBox { width: 600px; }
.up {
    display: flex; justify-content: space-between; align-items: center;
    background: rgba(255,255,255,0.05); padding: 12px 20px;
    border: 1px solid rgba(255,255,255,0.1); cursor: pointer; transition: 0.3s;
}
.up:hover { background: rgba(255, 215, 0, 0.1); border-color: var(--secondary); transform: translateX(10px); }
.up-info { display: flex; flex-direction: column; text-align:left; }
.cost { color: var(--secondary); font-weight: bold; }

</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="menu" class="panel">
 <div class="box-style">
  <div>
    <h1>Skull<br>Arena</h1>
    <p class="skull-count">Cr√¢nes : <span id="skullMenu">0</span> üíÄ</p>
    <p style="font-size:14px; color:#aaa; margin-top:-10px">Meilleure Vague : <span id="maxWaveMenu" style="color:#fff">1</span></p>
  </div>
  <button class="btn" onclick="startGame()">Combat</button>
  <button class="btn gold" onclick="openPass()">üèÜ Skull Pass</button>
  <button class="btn secondary" onclick="openShop()">Arsenal</button>
 </div>
</div>

<div id="passMenu" class="panel" style="display:none">
 <div class="box-style">
  <div class="pass-header">
   <h2>üèÜ Skull Pass</h2>
   <p style="margin:5px 0 0; color:#aaa; font-size:14px">Progresse dans les vagues pour d√©bloquer.</p>
   <div class="skull-count" style="font-size:18px; margin-top:5px">Solde : <span id="skullPass">0</span> üíÄ</div>
  </div>
  
  <div class="pass-list" id="passContainer">
   </div>
  
  <button class="btn secondary" style="margin-top:10px" onclick="closePass()">Retour</button>
 </div>
</div>

<div id="hud" style="display:none">
 <div class="hud-item"><span>VIE</span><div class="bar-cont"><div id="hpBar"></div></div></div>
 <div class="hud-item" style="border-color: var(--secondary)">üíÄ <span id="skullTxt">0</span></div>
 <div class="hud-item" style="border-color: #fff">üåä VAGUE <span id="waveTxt">1</span></div>
</div>

<div id="shop" class="panel" style="display:none">
 <div class="box-style shopBox">
  <h2>Armurerie</h2>
  <div class="up" onclick="buy('damage',10)">
   <div class="up-info"><span style="font-weight:bold">üí• D√©g√¢ts</span><span style="font-size:12px;color:#888">Niveau <span id="lvl-damage">1</span></span></div><span class="cost">10 üíÄ</span>
  </div>
  <div class="up" onclick="buy('range',8)">
   <div class="up-info"><span style="font-weight:bold">üìè Port√©e</span><span style="font-size:12px;color:#888">Niveau <span id="lvl-range">1</span></span></div><span class="cost">8 üíÄ</span>
  </div>
  <div class="up" onclick="buy('speed',8)">
   <div class="up-info"><span style="font-weight:bold">üèÉ Vitesse</span><span style="font-size:12px;color:#888">Niveau <span id="lvl-speed">1</span></span></div><span class="cost">8 üíÄ</span>
  </div>
  <div class="up" onclick="buy('fire',12)">
   <div class="up-info"><span style="font-weight:bold">‚ö° Cadence</span><span style="font-size:12px;color:#888">Niveau <span id="lvl-fire">1</span></span></div><span class="cost">12 üíÄ</span>
  </div>
  <button class="btn secondary" style="margin-top:20px" onclick="closeShop()">Retour</button>
 </div>
</div>

<div id="pause" class="panel" style="display:none">
 <h1 style="font-size:80px">PAUSE</h1>
</div>

<script>
/* --- SETUP --- */
const canvas=document.getElementById('game'),ctx=canvas.getContext('2d');
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
window.addEventListener('resize',resize); resize();

let keys={};
window.addEventListener('keydown',e=>{keys[e.key.toLowerCase()]=true;if(e.key==='Escape'&&state==='game')togglePause()});
window.addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);

/* --- DATA & SAVE --- */
let skulls = +localStorage.getItem('skulls_v3')||0;
let maxWaveRecord = +localStorage.getItem('maxWave_v3')||1;
let levels = JSON.parse(localStorage.getItem('levels_v3')||'{"damage":1,"range":1,"speed":1,"fire":1}');
let claimedTiers = JSON.parse(localStorage.getItem('claimedTiers_v3')||'[]');

function save(){
    localStorage.setItem('skulls_v3',skulls);
    localStorage.setItem('levels_v3',JSON.stringify(levels));
    localStorage.setItem('maxWave_v3',maxWaveRecord);
    localStorage.setItem('claimedTiers_v3',JSON.stringify(claimedTiers));
}

function updateUI(){
    ['skullMenu','skullTxt','skullPass'].forEach(id => {
        if(document.getElementById(id)) document.getElementById(id).textContent = Math.floor(skulls);
    });
    document.getElementById('maxWaveMenu').textContent = maxWaveRecord;
    for(const k in levels) if(document.getElementById('lvl-'+k)) document.getElementById('lvl-'+k).textContent=levels[k];
}
updateUI();

/* --- PASS LOGIC --- */
const TOTAL_TIERS = 100;
const MIN_WAVE = 10;
const MAX_WAVE = 20000;

// G√©n√®re les donn√©es du pass
function getPassData(tierIndex) { // 0 √† 99
    // Formule lin√©aire pour les vagues : de 10 √† 20000
    let waveReq = Math.floor(MIN_WAVE + (tierIndex * ((MAX_WAVE - MIN_WAVE) / (TOTAL_TIERS - 1))));
    // Formule exponentielle douce pour les r√©compenses
    let reward = Math.floor(50 * Math.pow(1.1, tierIndex)); 
    // Ajustement manuel pour que √ßa grimpe bien mais reste lisible
    reward = Math.floor((50 + (tierIndex * 200)) * (1 + (tierIndex/20)));
    
    return { id: tierIndex, wave: waveReq, reward: reward };
}

function openPass() {
    document.getElementById('menu').style.display='none';
    document.getElementById('passMenu').style.display='flex';
    renderPass();
}

function closePass() {
    document.getElementById('passMenu').style.display='none';
    document.getElementById('menu').style.display='flex';
    updateUI();
}

function renderPass() {
    const container = document.getElementById('passContainer');
    container.innerHTML = '';
    
    // On boucle de 0 √† 99
    for(let i=0; i<TOTAL_TIERS; i++) {
        const data = getPassData(i);
        const isClaimed = claimedTiers.includes(i);
        const isUnlocked = maxWaveRecord >= data.wave;
        
        let statusClass = isClaimed ? 'claimed' : (isUnlocked ? 'unlocked' : 'locked');
        let btnClass = isClaimed ? 'done' : (isUnlocked ? 'ready' : 'lock');
        let btnText = isClaimed ? '‚úî Re√ßu' : (isUnlocked ? 'R√©cup√©rer' : 'üîí');
        let action = (isUnlocked && !isClaimed) ? `onclick="claimReward(${i})"` : '';

        const html = `
        <div class="pass-row ${statusClass}" id="tier-${i}">
            <div class="tier-badge">${i+1}</div>
            <div class="pass-info">
                <div class="pass-reward">üí∞ ${data.reward.toLocaleString()}</div>
                <div class="pass-wave">Requis: Vague ${data.wave}</div>
            </div>
            <button class="claim-btn ${btnClass}" ${action}>${btnText}</button>
        </div>
        `;
        container.innerHTML += html; // Note: Flex-direction: column-reverse g√®re l'ordre visuel
    }
}

function claimReward(index) {
    if(claimedTiers.includes(index)) return;
    const data = getPassData(index);
    if(maxWaveRecord >= data.wave) {
        skulls += data.reward;
        claimedTiers.push(index);
        save();
        updateUI();
        renderPass(); // Rafraichir l'affichage
    }
}

/* --- GAME ENGINE --- */
let state='menu',player,enemies=[],slashes=[],particles=[];
let wave=1,spawnLeft=0,fireCooldown=0;

class Player{
 constructor(){this.x=canvas.width/2;this.y=canvas.height/2;this.r=18;this.hp=this.maxHp=100;}
 get speed(){return 4*(1+levels.speed*0.1)}
 get damage(){return 20*(1+levels.damage*0.2)}
 update(){
  let dx=(keys['d']||keys['arrowright']?1:0)-(keys['a']||keys['arrowleft']?1:0);
  let dy=(keys['s']||keys['arrowdown']?1:0)-(keys['w']||keys['arrowup']?1:0);
  if(dx||dy){const l=Math.hypot(dx,dy);this.x+=dx/l*this.speed;this.y+=dy/l*this.speed}
  this.x=Math.max(this.r,Math.min(canvas.width-this.r,this.x));
  this.y=Math.max(this.r,Math.min(canvas.height-this.r,this.y));
 }
 draw(){
  ctx.save();ctx.translate(this.x,this.y);
  ctx.shadowColor='#ffd700';ctx.shadowBlur=20;
  ctx.fillStyle='#ffd700';ctx.beginPath();ctx.arc(0,0,this.r,0,Math.PI*2);ctx.fill();
  ctx.shadowBlur=0;
  ctx.fillStyle='#000';ctx.beginPath();ctx.arc(-6,-5,4,0,Math.PI*2);ctx.arc(6,-5,4,0,Math.PI*2);ctx.fill();
  ctx.restore();
 }
}

class Enemy{
 constructor(bossTier=0){ 
  this.tier = bossTier;
  let s=Math.floor(Math.random()*4);
  this.x=s==0?-50:s==1?canvas.width+50:Math.random()*canvas.width;
  this.y=s<2?Math.random()*canvas.height:s==2?-50:canvas.height+50;
  
  if(this.tier === 2) { // MEGA BOSS
      this.r = 60; this.maxHp = 2000 + (wave*50); this.speed = 0.6; this.color = '#ff00ff'; this.reward = 100;
  } else if (this.tier === 1) { // BOSS
      this.r = 35; this.maxHp = 500 + (wave*20); this.speed = 0.9; this.color = '#ff5500'; this.reward = 20;
  } else {
      this.r = 16; this.maxHp = 60 + (wave*5); this.speed = 1.5 + (Math.random()*0.5); this.color = '#ff0055'; this.reward = 1;
  }
  this.hp=this.maxHp; this.flash=0;
 }
 update(){
  let dx=player.x-this.x, dy=player.y-this.y, d=Math.hypot(dx,dy)||1;
  this.x+=dx/d*this.speed; this.y+=dy/d*this.speed;
  if(d<this.r+player.r){
      let dmg = this.tier===2 ? 2 : (this.tier===1 ? 1 : 0.5);
      player.hp -= dmg;
  }
 }
 draw(){
  ctx.save();ctx.translate(this.x,this.y);
  if(this.flash>0){ ctx.fillStyle='#fff'; ctx.shadowBlur=30; ctx.shadowColor='#fff'; }
  else { ctx.fillStyle=this.color; ctx.shadowBlur=15; ctx.shadowColor=this.color; }
  
  ctx.beginPath();ctx.arc(0,0,this.r,0,Math.PI*2);ctx.fill();
  ctx.shadowBlur=0;
  ctx.fillStyle='#000';
  ctx.beginPath(); let eyeOff = this.r/3;
  ctx.arc(-eyeOff,-eyeOff/1.5,eyeOff/2,0,Math.PI*2); ctx.arc(eyeOff,-eyeOff/1.5,eyeOff/2,0,Math.PI*2); ctx.fill();
  
  if(this.tier > 0){
   ctx.translate(-this.r, -this.r-15);
   ctx.fillStyle='#333'; ctx.fillRect(0,0,this.r*2,8);
   ctx.fillStyle=this.tier===2?'#f0f':'#f50'; ctx.fillRect(0,0,(this.hp/this.maxHp)*this.r*2,8);
  }
  ctx.restore();
  this.flash--;
 }
}

class Slash{
 constructor(target){
  this.x=player.x;this.y=player.y;
  let dx=target.x-player.x, dy=target.y-player.y, d=Math.hypot(dx,dy)||1;
  this.vx=(dx/d)*18; this.vy=(dy/d)*18;
  this.life=20*(1+levels.range*0.2);
 }
 update(){
  this.x+=this.vx;this.y+=this.vy;this.life--;
  for(const e of enemies){
   if(Math.hypot(e.x-this.x,e.y-this.y)<e.r+10){
    e.hp-=player.damage; e.flash=3; this.life=0;
    // Particules
    break;
   }
  }
 }
 draw(){
  ctx.save();ctx.translate(this.x,this.y);ctx.rotate(Math.atan2(this.vy,this.vx));
  ctx.fillStyle='#fff';ctx.shadowColor='#ffaa00';ctx.shadowBlur=10;
  ctx.beginPath();ctx.rect(-10,-3,20,6);ctx.fill();
  ctx.restore();
 }
}

function startGame(){
 state='game';document.getElementById('menu').style.display='none';
 document.getElementById('hud').style.display='block';
 player=new Player();enemies=[];slashes=[];particles=[];wave=1;spawnLeft=5;
 updateUI();
}

function gameOver(){
    if(wave > maxWaveRecord) maxWaveRecord = wave; // Sauvegarde record
    save(); state='menu';
    document.getElementById('hud').style.display='none';
    document.getElementById('menu').style.display='flex';
    updateUI();
}

function togglePause(){
 state=state==='pause'?'game':'pause';
 document.getElementById('pause').style.display=state==='pause'?'flex':'none';
}

function openShop(){document.getElementById('menu').style.display='none';document.getElementById('shop').style.display='flex';updateUI();}
function closeShop(){document.getElementById('shop').style.display='none';document.getElementById('menu').style.display='flex';updateUI();}

function buy(type,baseCost){
 if(skulls>=baseCost){skulls-=baseCost;levels[type]++;save();updateUI();}
}

function loop(){
 ctx.fillStyle='#050505';ctx.fillRect(0,0,canvas.width,canvas.height);
 
 if(state==='game'){
  if(spawnLeft>0 && enemies.length < 8){
      spawnLeft--;
      let isLast = spawnLeft === 0;
      let tier = 0;
      if(isLast && wave%50===0) tier = 2;
      else if(isLast && wave%10===0) tier = 1;
      enemies.push(new Enemy(tier));
  }
  
  if(spawnLeft===0 && enemies.length===0){
      wave++;
      spawnLeft=5+Math.floor(wave*1.5);
      document.getElementById('waveTxt').textContent=wave;
  }

  player.update();player.draw();
  
  fireCooldown--;
  if(fireCooldown<=0 && enemies.length>0){
   let closest=enemies.reduce((a,b)=>Math.hypot(a.x-player.x,a.y-player.y)<Math.hypot(b.x-player.x,b.y-player.y)?a:b);
   slashes.push(new Slash(closest));
   fireCooldown=15/(1+levels.fire*0.2);
  }

  slashes=slashes.filter(s=>s.life>0); slashes.forEach(s=>{s.update();s.draw()});
  
  enemies=enemies.filter(e=>{
   if(e.hp<=0){
    skulls+=e.reward;
    return false;
   }
   e.update(); e.draw();
   return true;
  });

  document.getElementById('hpBar').style.width=(Math.max(0,player.hp)/player.maxHp*100)+'%';
  document.getElementById('skullTxt').textContent=Math.floor(skulls);
  
  if(player.hp<=0) gameOver();
 }
 requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>