<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FDPCrypto | Pro Terminal</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
    <style>
        :root {
            --bg: #0b0e11; --card: #1e2329; --text: #eaecef;
            --subtext: #848e9c; --primary: #f0b90b; --border: #333;
            --up: #0ecb81; --down: #f6465d;
        }
        [data-theme="light"] {
            --bg: #f5f5f5; --card: #ffffff; --text: #1e2329;
            --subtext: #707a8a; --primary: #c99400; --border: #e0e0e0;
            --up: #03a66d; --down: #cf304a;
        }

        body {
            background-color: var(--bg); color: var(--text);
            font-family: 'Inter', -apple-system, sans-serif; margin: 0; padding: 20px;
            transition: background 0.3s, color 0.3s;
        }

        .terminal {
            max-width: 1200px; margin: 0 auto; display: grid;
            grid-template-columns: 1fr 300px; gap: 20px;
        }

        .main-panel { background: var(--card); border-radius: 12px; border: 1px solid var(--border); padding: 24px; }
        
        .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        .price-box h1 { font-size: 0.9rem; color: var(--subtext); margin: 0; text-transform: uppercase; }
        .current-price { font-size: 2.8rem; font-weight: 800; color: var(--primary); font-variant-numeric: tabular-nums; }

        .theme-toggle {
            background: var(--border); border: none; color: var(--text);
            padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 0.8rem;
        }

        #chart-container { height: 450px; margin: 20px 0; border-top: 1px solid var(--border); padding-top: 10px; }

        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px; }
        .stat-item { background: var(--bg); padding: 15px; border-radius: 8px; border: 1px solid var(--border); }
        .stat-label { font-size: 0.75rem; color: var(--subtext); margin-bottom: 5px; }
        .stat-value { font-size: 1.1rem; font-weight: bold; }

        .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px; }
        button.trade {
            padding: 20px; border: none; border-radius: 8px; font-weight: bold;
            font-size: 1.1rem; cursor: pointer; color: white; transition: 0.2s;
        }
        .buy-btn { background: var(--up); }
        .sell-btn { background: var(--down); }
        button:hover { opacity: 0.9; transform: translateY(-2px); }

        .sidebar { background: var(--card); border-radius: 12px; border: 1px solid var(--border); padding: 20px; font-size: 0.85rem; }
        .log-item { border-bottom: 1px solid var(--border); padding: 8px 0; color: var(--subtext); }
        
        #game-over {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); color: white; display: none;
            flex-direction: column; justify-content: center; align-items: center; z-index: 1000;
        }
    </style>
</head>
<body>

<div id="game-over">
    <h1 style="color:var(--down); font-size: 5rem;">BANKRUPTCY</h1>
    <p>Votre capital total est tomb√© sous le seuil critique.</p>
    <button onclick="location.reload()" style="background:var(--primary); padding:15px 30px; border:none; border-radius:5px; cursor:pointer;">RESTART TERMINAL</button>
</div>

<div class="terminal">
    <div class="main-panel">
        <div class="header">
            <div class="price-box">
                <h1>FDP/USD Spot Market</h1>
                <div class="current-price" id="price-tag">$100.00</div>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()">üåì Th√®me</button>
        </div>

        <div id="chart-container">
            <canvas id="mainChart"></canvas>
        </div>

        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-label">DISPONIBLE</div>
                <div class="stat-value" id="user-cash">$1,000.00</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">VOS FDP</div>
                <div class="stat-value" id="user-crypto">0.00</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">VALEUR TOTALE</div>
                <div class="stat-value" id="user-total" style="color:var(--primary)">$1,000.00</div>
            </div>
        </div>

        <div class="actions">
            <button class="trade buy-btn" onclick="trade('buy')">ACHETER (LONG)</button>
            <button class="trade sell-btn" onclick="trade('sell')">VENDRE (SHORT)</button>
        </div>
    </div>

    <div class="sidebar">
        <h3 style="margin-top:0">Market Activity</h3>
        <div style="margin-bottom: 10px; color: var(--subtext); font-size: 0.7rem;">Bots actifs : 100</div>
        <div id="market-feed"></div>
    </div>
</div>

<script>
    // --- MOTEUR √âCONOMIQUE ---
    const BASE_PRICE = 100;
    const SENSITIVITY = 5.5; 
    const TAX = 0.005; // 0.5% frais (plus r√©aliste)
    let achat_total = 0;
    let marketVolatility = 0; // Bruit al√©atoire cumul√©
    
    // Joueur principal
    let player = { cash: 1000, crypto: 0 };
    
    // Cr√©ation de 100 Bots avec des profils diff√©rents
    let bots = [];
    for(let i=0; i<100; i++) {
        bots.push({
            id: i,
            cash: Math.random() * 2000 + 500,
            crypto: 0,
            aggression: Math.random() * 0.05 // Chance d'agir par tick
        });
    }

    // --- GRAPHIQUE ---
    const ctx = document.getElementById('mainChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: Array(60).fill(''),
            datasets: [{
                data: Array(60).fill(100),
                borderColor: '#f0b90b',
                borderWidth: 2,
                pointRadius: 0,
                tension: 0.1,
                fill: false
            }]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            scales: {
                x: { display: false },
                y: { grid: { color: 'rgba(128,128,128,0.1)' }, ticks: { color: '#848e9c' } }
            },
            plugins: {
                legend: { display: false },
                zoom: {
                    pan: { enabled: true, mode: 'x' },
                    zoom: { wheel: { enabled: true }, mode: 'x' }
                }
            }
        }
    });

    // Formatteur d'argent
    const fmt = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });

    function getPrice() {
        // Prix = Deterministe (achat_total) + Al√©atoire (Volatility)
        return Math.max(0.1, BASE_PRICE + (achat_total * SENSITIVITY) + marketVolatility);
    }

    // --- ACTIONS ---
    function trade(type, entity = player) {
        let price = getPrice();
        let cost = type === 'buy' ? price * (1 + TAX) : price * (1 - TAX);

        if (type === 'buy' && entity.cash >= cost) {
            entity.cash -= cost;
            entity.crypto++;
            achat_total++;
            if(entity === player) logNews(`Achat ex√©cut√© √† ${fmt.format(price)}`);
        } else if (type === 'sell' && entity.crypto > 0) {
            entity.cash += cost;
            entity.crypto--;
            achat_total--;
            if(entity === player) logNews(`Vente ex√©cut√©e √† ${fmt.format(price)}`);
        }
        updateUI();
    }

    // --- LOGIQUE MARCH√â ---
    function tick() {
        // 1. Ajouter du "bruit" r√©aliste (Random Walk)
        marketVolatility += (Math.random() * 2 - 1);

        // 2. Faire agir les bots
        bots.forEach(b => {
            if (Math.random() < b.aggression) {
                let p = getPrice();
                // Strat√©gie simple : si prix bas, ach√®te. Si prix haut, vend.
                if (p < (BASE_PRICE + achat_total * SENSITIVITY) && b.cash > p) trade('buy', b);
                else if (b.crypto > 0) trade('sell', b);
            }
        });

        // 3. V√©rifier d√©faite
        let totalVal = player.cash + (player.crypto * getPrice());
        if (totalVal < 5) document.getElementById('game-over').style.display = 'flex';

        updateUI();
    }

    function updateUI() {
        let p = getPrice();
        document.getElementById('price-tag').innerText = fmt.format(p);
        document.getElementById('user-cash').innerText = fmt.format(player.cash);
        document.getElementById('user-crypto').innerText = player.crypto.toFixed(2);
        
        let totalVal = player.cash + (player.crypto * p);
        const totalEl = document.getElementById('user-total');
        totalEl.innerText = fmt.format(totalVal);
        
        // Couleur dynamique du prix
        chart.data.datasets[0].borderColor = p >= 100 ? '#0ecb81' : '#f6465d';

        chart.data.datasets[0].data.push(p);
        chart.data.labels.push("");
        if(chart.data.datasets[0].data.length > 100) {
            chart.data.datasets[0].data.shift();
            chart.data.labels.shift();
        }
        chart.update('none');
    }

    function logNews(msg) {
        const feed = document.getElementById('market-feed');
        const time = new Date().toLocaleTimeString([], {hour: '2min', minute:'2-digit', second:'2-digit'});
        feed.innerHTML = `<div class="log-item"><b>[${time}]</b> ${msg}</div>` + feed.innerHTML;
        if(feed.children.length > 10) feed.lastElementChild.remove();
    }

    function toggleTheme() {
        const body = document.body;
        const current = body.getAttribute('data-theme');
        body.setAttribute('data-theme', current === 'light' ? 'dark' : 'light');
    }

    setInterval(tick, 1000);
    updateUI();
</script>

</body>
</html>