<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tableau de Bord Admin - Console de Jeu</title>
<style>
/* R√©utilisation et adaptation du style de connecte.html pour un look coh√©rent */
:root {
    --bg-color: #0b0c10;
    --card-bg: rgba(255, 255, 255, 0.05);
    --primary-color: #00bfff;
    --secondary-color: #1de9b6;
    --text-color: #fff;
    --light-text: #aaa;
    --border-color: #333;
    --shadow-color: rgba(0, 0, 0, 0.6);
}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Arial,sans-serif;}
body{background:var(--bg-color);color:var(--text-color);min-height:100vh;display:flex;flex-direction:column;}

/* Structure principale */
.dashboard-container {
    display: flex;
    flex-grow: 1;
    padding-top: 60px;
}

/* En-t√™te (style Search Console) */
.header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 60px;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    padding: 0 20px;
    border-bottom: 1px solid var(--border-color);
    z-index: 1000;
}
.header-logo {
    font-size: 24px;
    font-weight: bold;
    color: var(--primary-color);
    margin-right: 40px;
}
.header-title {
    font-size: 18px;
    color: var(--light-text);
}

/* Barre Lat√©rale (Navigation) */
.sidebar {
    width: 250px;
    background: rgba(0, 0, 0, 0.3);
    padding: 20px 0;
    border-right: 1px solid var(--border-color);
    flex-shrink: 0;
    transition: width 0.3s ease;
}
.nav-group-title {
    color: var(--light-text);
    padding: 10px 20px 5px;
    font-size: 12px;
    text-transform: uppercase;
    font-weight: 600;
}
.nav-item {
    display: flex;
    align-items: center;
    padding: 12px 20px;
    cursor: pointer;
    font-size: 15px;
    transition: background 0.2s, color 0.2s;
    color: var(--light-text);
    border-left: 3px solid transparent;
}
.nav-item:hover {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-color);
}
.nav-item.active {
    background: rgba(0, 191, 255, 0.1);
    color: var(--primary-color);
    border-left-color: var(--primary-color);
    font-weight: 600;
}
.nav-item i {
    margin-right: 10px;
    font-size: 18px;
}

/* Contenu Principal */
.main-content {
    flex-grow: 1;
    padding: 20px;
    overflow-y: auto;
}
.content-section {
    display: none;
    animation: fadeIn 0.5s ease-out;
}
.content-section.active {
    display: block;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

h2 {
    font-size: 28px;
    margin-bottom: 20px;
    color: var(--primary-color);
}

/* Style des cartes/panneaux */
.card {
    background: var(--card-bg);
    backdrop-filter: blur(20px);
    border-radius: 15px;
    padding: 30px;
    margin-bottom: 25px;
    box-shadow: 0 5px 15px var(--shadow-color);
}

/* Formulaires et entr√©es */
.form-group {
    margin-bottom: 15px;
}
.form-group label {
    display: block;
    margin-bottom: 8px;
    font-size: 14px;
    color: var(--light-text);
}
/* Base style for inputs and selects */
.form-control, .select-control {
    width: 100%;
    padding: 10px 15px;
    border-radius: 10px;
    color: var(--text-color);
    font-size: 15px;
    transition: all 0.3s;
    -webkit-appearance: none;
    appearance: none;
}
.form-control {
    background: rgba(255, 255, 255, 0.1); 
    border: 1px solid rgba(255, 255, 255, 0.2);
}
/* Style Sp√©cifique pour le menu d√©roulant (Couleur Secondary-Color) */
.select-control {
    background: rgba(29, 233, 182, 0.15); /* Utilisation de la secondary-color transparente */
    border: 1px solid var(--secondary-color); /* Bordure en secondary-color */
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%231de9b6'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 15px center;
    background-size: 10px;
    padding-right: 35px;
}
.form-control:focus, .select-control:focus {
    border-color: var(--primary-color); 
    box-shadow: 0 0 10px rgba(0, 191, 255, 0.4);
    outline: none;
}

/* Boutons */
.btn {
    padding: 12px 25px;
    border: none;
    border-radius: 15px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    background: var(--primary-color);
    color: var(--text-color);
    box-shadow: 0 5px 15px rgba(0, 191, 255, 0.4);
}
.btn:hover {
    background: var(--secondary-color);
    box-shadow: 0 0 20px rgba(29, 233, 182, 0.6);
    transform: translateY(-2px);
}

/* Tableaux */
.ranking-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}
/* Ajout du curseur pointer pour les lignes cliquables */
.ranking-table tbody tr {
    cursor: pointer; 
}
.ranking-table tbody tr:hover {
    background: rgba(0, 191, 255, 0.05); /* Highlight on hover for click */
}

.ranking-table th, .ranking-table td {
    padding: 15px;
    text-align: left;
    border-bottom: 1px solid var(--border-color);
}
.ranking-table th {
    color: var(--primary-color);
    font-weight: 600;
    text-transform: uppercase;
    font-size: 14px;
    background: rgba(0, 191, 255, 0.05);
}


/* Affichage des statistiques */
.stats-results {
    margin-top: 5px; /* R√©duit l'espace car le titre est dans la sous-carte */
}
.stats-results div {
    background: rgba(255, 255, 255, 0.08);
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 8px;
    font-size: 15px;
    display: flex;
    justify-content: space-between;
}
.stats-results strong {
    color: var(--secondary-color);
}

/* Logs */
#logContent {
    background: #111;
    color: #00ff77; /* Couleur n√©on verte pour les logs */
    padding: 15px;
    border-radius: 10px;
    font-family: 'Consolas', 'Courier New', monospace;
    white-space: pre-wrap;
    max-height: 500px;
    overflow-y: auto;
    font-size: 12px;
}

.error-message {
    color: #ff5555;
    background: rgba(255, 85, 85, 0.1);
    padding: 15px;
    border-radius: 10px;
    text-align: center;
}
.loading-message {
    color: var(--primary-color);
    text-align: center;
    padding: 20px;
}
</style>
</head>
<body>

<div class="header">
    <div class="header-logo">üéÆ Console</div>
    <div class="header-title">Tableau de Bord</div>
</div>

<div class="dashboard-container">
    <div class="sidebar">
        <div class="nav-group-title">Analytics & Donn√©es</div>
        <div class="nav-item active" data-tab="ranking">
            <i class="fas fa-trophy">üèÜ</i> Classement
        </div>
        <div class="nav-item" data-tab="player-stats">
            <i class="fas fa-user-chart">üìà</i> Statistiques de Joueur
        </div>
        <div class="nav-group-title" style="margin-top: 20px;">Gestion</div>
        <div class="nav-item" data-tab="users">
            <i class="fas fa-users">üë•</i> Gestion des Utilisateurs
        </div>
        <div class="nav-item" data-tab="content">
            <i class="fas fa-cogs">‚öôÔ∏è</i> Param√®tres
        </div>
        <div class="nav-item" data-tab="reports">
            <i class="fas fa-bug">üö®</i> Logs Serveur
        </div>
    </div>

    <div class="main-content">
        <div class="content-section active" id="ranking">
            <h2>Classement Global</h2>
            <div class="card">
                <p>classement des meilleurs joueurs</p>
                <div class="form-group">
                    <label for="rankingGameSelect">S√©lectionner un Jeu :</label>
                    <select id="rankingGameSelect" class="select-control">
                        </select>
                </div>
                <button class="btn" id="loadRankingBtn">Charger le Classement</button>
            </div>

            <div class="card" id="rankingResultCard" style="display:none;">
                <h3>Top 10 : <span id="rankingGameTitle"></span></h3>
                <div id="rankingTableContainer">
                    </div>
                <div id="rankingMessage" class="loading-message" style="display:none;">Chargement...</div>
                <div id="rankingError" class="error-message" style="display:none;"></div>
            </div>
        </div>

        <div class="content-section" id="player-stats">
            <h2>Statistiques de Joueur</h2>
            <div class="card">
                <p>statistiques d√©taill√©es d'un joueur</p>
                <div class="form-group">
                    <label for="playerUsername">Nom d'utilisateur :</label>
                    <input type="text" id="playerUsername" class="form-control" placeholder="Entrez l'ID du joueur">
                </div>
                <button class="btn" id="loadPlayerStatsBtn">Charger les Statistiques</button>
            </div>

            <div class="card" id="statsResultCard" style="display:none;">
                <h3>Statistiques pour <span id="statsPlayerTitle"></span></h3>
                <div id="statsResultsContainer">
                    </div>
                <div id="statsMessage" class="loading-message" style="display:none;">Chargement...</div>
                <div id="statsError" class="error-message" style="display:none;"></div>
            </div>
        </div>
        
        <div class="content-section" id="users">
            <h2>Gestion des Utilisateurs</h2>
            <div class="card">
                <p>Affichez la liste de tous les utilisateurs</p>
                <button class="btn" id="loadUsersBtn">Actualiser la Liste</button>
            </div>
            
            <div class="card" id="usersResultCard" style="display:none;">
                <h3>Liste des Joueurs</h3>
                <div id="usersTableContainer">
                    </div>
                <div id="usersMessage" class="loading-message" style="display:none;">Chargement...</div>
                <div id="usersError" class="error-message" style="display:none;"></div>
            </div>
        </div>
        
        <div class="content-section" id="content">
            <h2>Param√®tres</h2>
            <div class="card"><p>Fonctionnalit√© en cours de d√©veloppement...</p></div>
        </div>
        
        <div class="content-section" id="reports">
            <h2>Logs Serveur</h2>
            <div class="card">
                <p>Configuration pas encore termin√©e</p>
                <button class="btn" id="loadLogsBtn" style="margin-bottom: 20px;">Charger</button>
                
                <div id="logsMessage" class="loading-message" style="display:none;">Tentative...</div>
                <div id="logsError" class="error-message" style="display:none;"></div>

                <pre id="logContent" style="margin-top: 20px; color: yellow;">Cliquez sur Charger</pre>
            </div>
        </div>
    </div>
</div>

<script>
        // =========================================================
        // Configuration et Variables Globales
        // =========================================================
        const API_BASE_URL = 'https://project-3-api-2bgb.onrender.com';
        const canvas = document.getElementById('astroDodgeCanvas');
        const ctx = canvas.getContext('2d');
        const startButton = document.getElementById('start-button');
        const mainMenuButton = document.getElementById('main-menu-button');
        const scoreDisplay = document.getElementById('current-score');
        const creditsDisplay = document.getElementById('credits-display');
        const unlockedCarsDisplay = document.getElementById('unlocked-cars');
        const messageArea = document.getElementById('message-area');
        const shopDiv = document.getElementById('shop');
        const carShopDiv = document.getElementById('car-shop');
        
        let username = localStorage.getItem("username") || "Invit√©";
        let score = 0;
        let credits = 0;
        let unlockedCars = ["Default"]; // La voiture de base
        let unlockedCarsNames = ["Default"]; // Noms pour l'affichage et l'API
        let currentCar = "Default"; // Voiture actuellement s√©lectionn√©e
        let gameRunning = false;
        
        // Donn√©es du jeu (√† remplacer par la logique du jeu r√©el)
        let gameData = {
            currentScore: 0,
            playerX: canvas.width / 2,
            playerY: canvas.height - 50,
            asteroids: []
        };
        
        const carModels = {
            "Default": { price: 0, color: 'white', size: 30 },
            "Racer": { price: 500, color: 'blue', size: 25 },
            "Tank": { price: 1000, color: 'green', size: 40 }
        };

        // =========================================================
        // Fonctions d'Affichage et UI
        // =========================================================

        function updateUI() {
            scoreDisplay.textContent = `Score: ${score}`;
            creditsDisplay.textContent = credits;
            unlockedCarsDisplay.textContent = unlockedCarsNames.join(', ');
            renderShop();
        }

        function renderShop() {
            carShopDiv.innerHTML = '';
            Object.keys(carModels).forEach(carName => {
                const car = carModels[carName];
                const carElement = document.createElement('div');
                carElement.className = 'car-item';
                
                if (unlockedCarsNames.includes(carName)) {
                    carElement.innerHTML = `
                        <span>${carName} (D√©bloqu√©e)</span>
                        <button onclick="selectCar('${carName}')" ${currentCar === carName ? 'disabled' : ''}>
                            ${currentCar === carName ? 'S√©lectionn√©e' : 'S√©lectionner'}
                        </button>
                    `;
                } else {
                    carElement.innerHTML = `
                        <span>${carName} (${car.price} Cr√©dits)</span>
                        <button onclick="buyCar('${carName}', ${car.price})">Acheter</button>
                    `;
                }
                carShopDiv.appendChild(carElement);
            });
        }
        
        function selectCar(carName) {
            if (unlockedCarsNames.includes(carName)) {
                currentCar = carName;
                messageArea.textContent = `${carName} s√©lectionn√©e !`;
                updateUI();
            }
        }

        function buyCar(carName, price) {
            if (credits >= price) {
                credits -= price;
                unlockedCarsNames.push(carName);
                saveGameData(); // Sauvegarde apr√®s achat
                messageArea.textContent = `${carName} achet√©e !`;
                updateUI();
            } else {
                messageArea.textContent = `Pas assez de cr√©dits pour acheter ${carName}.`;
            }
        }

        // =========================================================
        // Logique de Jeu (Simplifi√©e)
        // =========================================================

        function startGame() {
            score = 0;
            gameRunning = true;
            startButton.style.display = 'none';
            mainMenuButton.style.display = 'none';
            shopDiv.style.display = 'none';
            messageArea.textContent = 'Jeu en cours... Esquivez !';
            updateUI();
            // Ici d√©marrer la boucle de jeu (ex: requestAnimationFrame)
            // Pour l'exemple, on va juste simuler une fin de partie
            setTimeout(endGame, 5000); 
        }

        function endGame() {
            gameRunning = false;
            score = Math.floor(Math.random() * 500) + 100; // Score al√©atoire pour test
            credits += Math.floor(score / 10); // Gain de cr√©dits
            messageArea.textContent = `Partie termin√©e! Score: ${score}. Vous avez gagn√© ${Math.floor(score / 10)} cr√©dits.`;
            saveGameData(); // Sauvegarde automatique √† la fin du jeu
            mainMenuButton.style.display = 'block';
            shopDiv.style.display = 'block';
            updateUI();
        }

        function showMainMenu() {
            startButton.style.display = 'block';
            mainMenuButton.style.display = 'none';
            shopDiv.style.display = 'block';
            messageArea.textContent = 'Bienvenue dans Astro Dodge!';
        }

        // =========================================================
        // REQU√äTES API CORRIG√âES
        // =========================================================

        /**
         * R√©cup√®re les donn√©es de jeu du joueur (Load).
         */
        async function loadGameData() {
            username = localStorage.getItem("username") || "Invit√©";
            messageArea.textContent = `Chargement des donn√©es pour ${username}...`;

            try {
                const response = await fetch(`${API_BASE_URL}/astro_dodge_get_data`, {
                    method: 'POST', 
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    // ‚úÖ CORRECTION : Cl√© 'username' correcte pour Flask
                    body: JSON.stringify({
                        'username': username
                    })
                });

                if (!response.ok) {
                    throw new Error(`Erreur HTTP! Statut: ${response.status}`);
                }

                const data = await response.json();
                
                // Mettre √† jour les variables globales avec les donn√©es du serveur
                credits = data.Coins || 0;
                unlockedCarsNames = Array.isArray(data.Voiture) ? data.Voiture : (data.Voiture ? [data.Voiture] : ["Default"]);
                
                if (username !== "Invit√©") {
                    messageArea.textContent = `Donn√©es de ${username} charg√©es.`;
                } else {
                    messageArea.textContent = "Mode invit√©. Vos donn√©es ne seront pas sauvegard√©es.";
                }
                
                updateUI();
                showMainMenu();

            } catch (error) {
                console.error("Erreur lors du chargement des donn√©es:", error);
                messageArea.textContent = "Erreur de connexion au serveur. D√©marrage en mode invit√©.";
                // Initialisation par d√©faut si √©chec
                credits = 0;
                unlockedCarsNames = ["Default"];
                updateUI();
                showMainMenu();
            }
        }

        /**
         * Sauvegarde les donn√©es de jeu du joueur (Save).
         */
        async function saveGameData() {
            if (username === "Invit√©") {
                console.log("Sauvegarde ignor√©e en mode Invit√©.");
                return;
            }
            
            // Corps de donn√©es √† envoyer avec la cl√© 'username' correcte
            const dataToSave = {
                username: username,
                Coins: credits, 
                Voiture: unlockedCarsNames 
            };

            try {
                const response = await fetch(`${API_BASE_URL}/astro_dodge_save_data`, {
                    method: 'POST', 
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dataToSave)
                });

                if (!response.ok) {
                    throw new Error(`Erreur HTTP! Statut: ${response.status}`);
                }

                const result = await response.json();
                if (result.status === 'success') {
                    console.log('Sauvegarde r√©ussie:', result);
                } else {
                    console.error('√âchec de la sauvegarde:', result.message);
                }

            } catch (error) {
                console.error("Erreur lors de la sauvegarde des donn√©es:", error);
            }
        }
        
        /**
         * R√©cup√®re le classement (Leaderboard).
         */
        async function getLeaderboardData() {
            try {
                const response = await fetch(`${API_BASE_URL}/astro_dodge_leaderboard`, {
                    method: 'POST', 
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    // Envoi d'un corps vide {} pour respecter le type POST/JSON
                    body: JSON.stringify({}) 
                });

                if (!response.ok) {
                    throw new Error(`Erreur HTTP! Statut: ${response.status}`);
                }

                const data = await response.json();
                console.log('Donn√©es du classement re√ßues:', data);
                
                // Logique pour afficher le classement ici
                return data;

            } catch (error) {
                console.error("Erreur lors de la r√©cup√©ration du classement:", error);
                return [];
            }
        }

        // =========================================================
        // √âv√©nements
        // =========================================================

        startButton.addEventListener('click', startGame);
        mainMenuButton.addEventListener('click', showMainMenu);

        // Au chargement de la page
        document.addEventListener('DOMContentLoaded', loadGameData);
    </script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</body>
</html>