<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test Argent Adsterra - URL Officielle</title>
    <style>
        body { 
            background: #0b0c10; 
            color: #fff; 
            font-family: sans-serif; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
        }
        .card { 
            background: rgba(255,255,255,0.05); 
            padding: 40px; 
            border-radius: 20px; 
            text-align: center; 
            border: 1px solid #00bfff; 
        }
        #montant { 
            font-size: 3rem; 
            font-weight: bold; 
            color: #1de9b6; 
            margin: 20px 0; 
        }
        .status { 
            font-size: 0.9rem; 
            color: #aaa; 
        }
        button {
            margin-top:20px; 
            padding:10px 20px; 
            cursor:pointer; 
            border:none;
            border-radius:10px;
            background:#00bfff;
            color:#fff;
            font-weight:bold;
            font-size:1rem;
        }
        button:hover {
            background:#1de9b6;
        }
    </style>
</head>
<body>

<div class="card">
    <h1>Argent Réel Adsterra</h1>
    <div id="montant">0.000 $</div>
    <div id="status" class="status">Initialisation...</div>
    <button onclick="getStats()">Actualiser</button>
</div>

<script>
    const API_KEY = "fe5ac021b0565b3de4e0a09bf2542ea1";
    const DOMAINS = ["projet2fdp.xo.je", "smart-link-3119793"];

    async function getStats() {
        const display = document.getElementById('montant');
        const statusDiv = document.getElementById('status');
        display.innerText = "...";
        statusDiv.innerText = "Chargement des revenus...";
        statusDiv.style.color = "#aaa";

        let total = 0;

        for (let domain of DOMAINS) {
            try {
                const response = await fetch(`https://api.adsterra.com/publisher/stats?domain=${domain}`, {
                    headers: {
                        "Authorization": `Bearer ${API_KEY}`
                    }
                });

                if (!response.ok) throw new Error("Réponse serveur non valide");

                const data = await response.json();
                console.log("Données reçues pour " + domain, data);

                if (data.items && Array.isArray(data.items)) {
                    data.items.forEach(item => {
                        total += parseFloat(item.revenue || 0);
                    });
                }

            } catch (err) {
                console.error("Erreur sur " + domain, err);
                statusDiv.innerText = `Erreur pour ${domain}`;
                statusDiv.style.color = "#ff5555";
            }
        }

        display.innerText = total.toFixed(3) + " $";
        statusDiv.innerText = "Dernière mise à jour réussie";
        statusDiv.style.color = "#1de9b6";
    }

    getStats();
</script>

</body>
</html>
