<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="index, follow">
<title>Connexion</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Arial,sans-serif;}
body,html{height:100%;display:flex;justify-content:center;align-items:center;background:#0b0c10;}
.container{background:rgba(255,255,255,0.05);backdrop-filter:blur(20px);border-radius:25px;padding:40px 35px;width:100%;max-width:420px;box-shadow:0 15px 40px rgba(0,0,0,0.6);text-align:center;transition:transform 0.3s ease;}
.container:hover{transform:translateY(-5px);}
.logo{font-size:55px;margin-bottom:25px;color:#00bfff;transition:0.3s;}
.logo:hover{color:#1de9b6;}
h1{color:#fff;font-size:26px;margin-bottom:12px;}
p.subtitle{color:#aaa;margin-bottom:30px;font-size:14px;}
.field{display:flex;align-items:center;margin-bottom:18px;background:rgba(255,255,255,0.08);backdrop-filter:blur(15px);border-radius:15px;padding:14px 12px;transition:all 0.3s ease;box-shadow:0 0 10px rgba(0,0,0,0.3);}
.field:hover{background:rgba(255,255,255,0.12);box-shadow:0 0 15px rgba(0,191,255,0.2);}
.field i{margin-right:12px;color:#888;font-size:18px;}
.field input{background:transparent;border:none;outline:none;color:#fff;flex:1;font-size:15px;padding:10px;border-radius:12px;transition:all 0.3s ease;}
.field input:focus{background:rgba(255,255,255,0.15);box-shadow:0 0 10px #00bfff88;backdrop-filter:blur(20px);}
.toggle-password{cursor:pointer;margin-left:8px;font-size:18px;color:#888;transition:0.3s;}
.toggle-password:hover{color:#00bfff;}
.btn{width:100%;padding:14px;border:none;border-radius:18px;font-size:16px;font-weight:bold;cursor:pointer;margin-bottom:15px;transition:all 0.3s ease;backdrop-filter:blur(10px);}
.btn-login{background:rgba(0,191,255,0.8);color:#fff;box-shadow:0 5px 20px rgba(0,191,255,0.4);}
.btn-login:hover{background:rgba(0,191,255,1);box-shadow:0 0 25px #00bfff88;transform:translateY(-2px);}
.switch-mode{background:transparent;border:2px solid #444;color:#00bfff;border-radius:18px;padding:14px;cursor:pointer;width:100%;font-weight:bold;font-size:14px;transition:all 0.3s;}
.switch-mode:hover{background:rgba(0,191,255,0.1);box-shadow:0 0 15px #00bfff66;}
.separator{display:flex;align-items:center;text-align:center;margin:15px 0;}
.separator::before,.separator::after{content:"";flex:1;height:1px;background:#333;}
.separator::before{margin-right:10px;}
.separator::after{margin-left:10px;}
.separator span{color:#666;font-size:12px;}
#statusLabel{min-height:20px;margin-bottom:10px;font-size:14px;font-weight:bold;color:#ff5555;}
.loading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:flex;justify-content:center;align-items:center;z-index:9999;flex-direction:column;color:#fff;font-size:16px;padding:20px;text-align:center;}
.spinner{width:50px;height:50px;border:5px solid #2d2d40;border-top:5px solid #00bfff;border-radius:50%;animation:spin 1s linear infinite;margin-bottom:15px;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
</style>
</head>
<body>

<div class="loading-overlay" id="loadingScreen" style="display:none;">
Â  Â  <div class="spinner"></div>
Â  Â  <div>Connexion au serveur...</div>
</div>

<div class="container" id="authContainer">
Â  Â  <div class="logo">Projet2fdp</div>
Â  Â  <h1 id="title">Se connecter</h1>
Â  Â  <p class="subtitle" id="subtitle">AccÃ©dez Ã  votre espace de jeu</p>

Â  Â  <div class="field">
Â  Â  Â  Â  <i>ğŸ‘¤</i>
Â  Â  Â  Â  <input type="text" id="username" placeholder="Nom d'utilisateur">
Â  Â  </div>
Â  Â  <div class="field">
Â  Â  Â  Â  <i>ğŸ”’</i>
Â  Â  Â  Â  <input type="password" id="password" placeholder="Mot de passe">
Â  Â  Â  Â  <span class="toggle-password" id="togglePassword">ğŸ‘</span>
Â  Â  </div>

Â  Â  <button class="btn btn-login" id="submitBtn">Se connecter</button>
Â  Â  <div id="statusLabel"></div>
Â  Â  <div class="separator"><span>ou</span></div>
Â  Â  <button class="switch-mode" id="switchBtn">CrÃ©er un compte</button>
</div>

<script>
    const PAGE_ID = "2000"; 

    (async function() {
        const API_URL_verif_version = "https://project-3-api-2bgb.onrender.com/get_latest_version";
        console.log('[verif version] Demarrage')
        try {
            // 1. Appel de la nouvelle route optimisÃ©e
            const response = await fetch(API_URL_verif_version);
            const result = await response.json();
            
            // On vÃ©rifie que la requÃªte a rÃ©ussi et qu'on a une donnÃ©e
            if (result.status !== "success" || !result.data) return;

            const latestVersion = String(result.data.Version);
            const savedVersion = localStorage.getItem(`version_${PAGE_ID}`);

            // PremiÃ¨re visite : on enregistre la version actuelle sans bloquer
            if (!savedVersion) {
                localStorage.setItem(`version_${PAGE_ID}`, latestVersion);
                return;
            }

            // Comparaison
            if (savedVersion !== latestVersion) {
                // SÃ©curitÃ© pour Ctrl+R / F5
                window.onbeforeunload = function() {
                    localStorage.setItem(`version_${PAGE_ID}`, latestVersion);
                };

                // Ã‰cran noir bloquant
                document.body.innerHTML = `
                    <div style="position:fixed;top:0;left:0;width:100%;height:100%;background:black;color:white;display:flex;justify-content:center;align-items:center;z-index:1000000;flex-direction:column;font-family:sans-serif;text-align:center;padding:20px;">
                        <h1 style="font-size:32px;margin-bottom:15px;color:#00bfff;">Mise Ã  jour requise</h1>
                        <p style="color:#aaa;max-width:500px;line-height:1.6;">La version ${latestVersion} est disponible. Veuillez recharger la page pour appliquer les changements.</p>
                        <button id="btn-update-now" style="margin-top:30px;padding:15px 40px;cursor:pointer;background:#00bfff;border:none;color:white;font-weight:bold;border-radius:12px;font-size:16px;box-shadow: 0 10px 20px rgba(0,191,255,0.3);">
                            Mettre Ã  jour et Recharger
                        </button>
                    </div>`;
                
                document.getElementById('btn-update-now').addEventListener('click', function() {
                    localStorage.setItem(`version_${PAGE_ID}`, latestVersion);
                    window.location.reload(true);
                });

                throw new Error("Mise Ã  jour bloquante");
            }
        } catch (error) {
            if (error.message !== "Mise Ã  jour bloquante") console.error("Erreur version:", error);
        }
    })();
// CrÃ©ation ou mise Ã  jour de 'cookies_accepted' Ã  'false'
localStorage.setItem('cookies_accepted', 'false');

const switchBtn=document.getElementById('switchBtn');
const title=document.getElementById('title');
const subtitle=document.getElementById('subtitle');
const submitBtn=document.getElementById('submitBtn');
const passwordInput=document.getElementById('password');
const togglePassword=document.getElementById('togglePassword');
let isLoginMode=true;

// Toggle login/signup
switchBtn.addEventListener('click',()=>{
Â  Â  isLoginMode=!isLoginMode;
Â  Â  if(isLoginMode){title.textContent="Se connecter";subtitle.textContent="AccÃ©dez Ã  votre espace de jeu";submitBtn.textContent="Se connecter";switchBtn.textContent="CrÃ©er un compte";}
Â  Â  else{title.textContent="CrÃ©er un compte";subtitle.textContent="Inscrivez-vous pour commencer Ã  jouer";submitBtn.textContent="S'inscrire";switchBtn.textContent="Se connecter";}
});

// Toggle mot de passe
togglePassword.addEventListener('click',()=>{
Â  Â  const type=passwordInput.getAttribute('type')==='password'?'text':'password';
Â  Â  passwordInput.setAttribute('type',type);
Â  Â  togglePassword.textContent=type==='text'?'ğŸ™ˆ':'ğŸ‘';
});

// Fonction login/signup
async function handleSubmit(){
Â  Â  const username=document.getElementById('username').value.trim();
Â  Â  const password=document.getElementById('password').value.trim();
Â  Â  
Â  Â  if(!username||!password){
Â  Â  Â  Â  alert("Veuillez remplir tous les champs !");
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â 

Â  Â  // Le reste du code (requÃªte API normale) ne s'exÃ©cute que si ce n'est PAS l'admin.
Â  Â  const data={id:username,password};
Â  Â  const url=isLoginMode?"https://project-3-api-2bgb.onrender.com/login":"https://project-3-api-2bgb.onrender.com/signup";
Â  Â  
Â  Â  try{
Â  Â  Â  Â  document.getElementById('loadingScreen').style.display='flex';
Â  Â  Â  Â  const response=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
Â  Â  Â  Â  const result=await response.json();
Â  Â  Â  Â  document.getElementById('loadingScreen').style.display='none';
Â  Â  Â  Â  if(result.status==="success"){
Â  Â  Â  Â  Â  Â  localStorage.setItem("username",username);
Â  Â  Â  Â  Â  Â  alert(isLoginMode?"Connexion rÃ©ussie !":"Compte crÃ©Ã© avec succÃ¨s !");
Â  Â  Â  Â  Â  Â  window.location.href="menu.html";
Â  Â  Â  Â  }
Â  Â  Â  Â  else{
Â  Â  Â  Â  Â  Â  alert(result.message||(isLoginMode?"ID ou mot de passe incorrect":"Impossible de crÃ©er le compte"));
Â  Â  Â  Â  }
Â  Â  }catch(err){
Â  Â  Â  Â  document.getElementById('loadingScreen').style.display='none';
Â  Â  Â  Â  alert("Erreur rÃ©seau : "+err);
Â  Â  }
}

// Clic sur le bouton
submitBtn.addEventListener('click',handleSubmit);

// Appui sur Enter dÃ©clenche le bouton
document.addEventListener('keydown',(e)=>{
Â  Â  if(e.key==='Enter'){handleSubmit();}
});
</script>

</body>
</html>