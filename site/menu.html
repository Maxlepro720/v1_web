<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Launcher</title>

<style>
/* -------------------------------------
Â  Â  ðŸŽ¨ STYLES CSS (DESKTOP/STANDARD - DÃ‰FAUT)
Â  Â  ------------------------------------- */
body { margin: 0; font-family: Arial, sans-serif; background: #0f1419; color: white; }

/* HEADER */
header { background: black; display: flex; align-items: center; padding: 20px 30px; gap: 20px; justify-content: space-between; }
header h1 { font-size: 26px; color: #60a5fa; margin: 0; }

/* NAV PRINCIPALE (sans le bouton de dÃ©connexion) */
#main-nav { display: flex; align-items: center; gap: 10px; flex-grow: 1; justify-content: flex-start; }

/* STYLES GÃ‰NÃ‰RAUX APPLIQUÃ‰S SEULEMENT AUX BOUTONS DANS #main-nav */
#main-nav button { background: #1f2937; color: white; border: none; padding: 12px 20px; cursor: pointer; border-radius: 6px; font-size: 15px; }
#main-nav button:hover { background: #374151; }

/* Style spÃ©cifique pour le bouton de dÃ©connexion */
#logout-button { background: #ef4444; color: white; border: none; padding: 12px 20px; cursor: pointer; border-radius: 6px; font-size: 15px; font-weight: bold; transition: background 0.2s; }
#logout-button:hover { background: #dc2626; }


/* Barre de recherche stylisÃ©e comme un bouton */
#search_bar { padding: 12px 20px; border-radius: 6px; border: none; outline: none; font-size: 15px; background: #1f2937; color: white; transition: background 0.2s; flex-grow: 1; max-width: 300px; }
#search_bar::placeholder { color: #d1d5db; }
#search_bar:focus { background: #374151; }

/* SECTION */
.section-title { font-size: 30px; margin-left: 30px; margin-top: 20px; }

/* GRID */
.game-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; padding: 20px 30px; }

/* GAME CARD */
.card { background: #1e293b; border-radius: 8px; overflow: hidden; transition: 0.2s; }
.card:hover { background: #2d3748; transform: scale(1.02); }
.card-image { height: 180px; display: flex; align-items: center; justify-content: center; font-size: 70px; color: white; }
.card-info { padding: 15px; }
.card-title { font-size: 20px; margin: 0; }
.card-genre { font-size: 14px; opacity: 0.7; margin-top: 6px; margin-bottom: 12px; }
.card button { width: 100%; background: #3b82f6; border: none; padding: 12px; color: white; cursor: pointer; font-size: 15px; border-radius: 6px; }
.card button:hover { background: #2563eb; }

/* -------------------------------------
Â  Â  ðŸ“² MEDIA QUERY POUR MOBILE (Max 600px)
Â  Â  ------------------------------------- */
@media (max-width: 600px) {
    /* HEADER: Vertical Stack et padding rÃ©duit */
    header { 
        flex-direction: column; 
        align-items: flex-start; 
        gap: 10px; /* RÃ©duction du gap */
        padding: 10px 15px; /* RÃ©duction du padding gÃ©nÃ©ral du header */
    }

    /* NAV PRINCIPALE: Full Width */
    #main-nav { 
        flex-direction: column; 
        width: 100%; 
        gap: 8px; /* RÃ©duction du gap dans la nav */
        order: 2; 
    }

    /* Boutons de la Nav: Full Width et padding rÃ©duit */
    #main-nav button {
        width: 100%;
        text-align: left; 
        padding: 10px 15px; /* RÃ©duction du padding des boutons */
    }

    /* Barre de recherche: Full Width et padding rÃ©duit */
    #search_bar {
        width: 100%;
        max-width: 100%;
        order: -1; 
        padding: 10px 15px; /* RÃ©duction du padding de la barre de recherche */
    }
    
    /* Bouton de dÃ©connexion: Full Width et padding rÃ©duit */
    #logout-button {
        width: 100%;
        order: 3; 
        text-align: center;
        margin-left: 0; 
        padding: 10px 15px; /* RÃ©duction du padding du bouton de dÃ©connexion */
    }
    
    /* Titre H1: Reste en haut, prend la position 1 */
    header h1 {
        order: 1;
    }

    /* GRID de jeux: 1 colonne */
    .game-grid {
        grid-template-columns: 1fr; 
        padding: 10px 15px;
    }
    
    /* Titre de Section */
    .section-title {
        margin-left: 15px;
    }
}
</style>
</head>
<body>

<header>
Â  Â  <h1>ðŸŽ® Â Accueil</h1>
Â  Â  <nav id="main-nav">
Â  Â  Â  Â  <button>ðŸ“š BibliothÃ¨que</button>
Â  Â  Â  Â  <input id="search_bar" placeholder="Rechercher">
Â  Â  Â  Â  <button>ðŸ‘¥ Amis</button>
Â  Â  </nav>
Â  Â  <button id="logout-button" onclick="handleLogoutAndRedirect()">ðŸšª DÃ©connexion</button>
</header>

<h2 class="section-title">Ma BibliothÃ¨que</h2>

<div class="game-grid" id="gameGrid"></div>

<script>
const API_URL = "https://project-3-api-2bgb.onrender.com";

/* -------------------------
Â  Â ðŸ“¦ LISTE DES JEUX
Â  Â ------------------------- */
const games = [
Â  Â  { id: 1, title: "Multiplayer Clicker", genre: "Clicker", link: "multiplayer_clicker.html", color: "#8b5cf6" },
Â  Â  { id: 2, title: "Private Clicker", genre: "Clicker", link: "private_clicker.html", color: "#f97316" },
Â  Â  { id: 3, title: "Coming Soon...", genre: "Not defined", link: "", color: "#06b6d4" },
Â  Â  { id: 4, title: "Coming Soon...", genre: "Not defined", link: "", color: "#eab308" },
Â  Â  { id: 5, title: "Coming Soon...", genre: "Not defined", link: "", color: "#14b8a6" },
Â  Â  { id: 6, title: "Coming Soon...", genre: "Not defined", link: "", color: "#ec4899" }
];

/* -------------------------
Â  Â ðŸ§‘â€ðŸ’» RÃ‰CUPÃ‰RATION ET VÃ‰RIFICATION DU USERNAME
Â  Â ------------------------- */
const username = localStorage.getItem("username");
let isLoggingOut = false; 

if (!username) {
Â  Â  window.location.href = 'index.html';
}

/* -------------------------------------
Â  Â ðŸš¨ GESTION DE LA DÃ‰CONNEXION (LOGOUT)
Â  Â ------------------------------------- */

/**
Â * GÃ¨re le logout initiÃ© par l'utilisateur (bouton).
Â * Effectue le /logout API et redirige vers index.html.
Â */
async function handleLogoutAndRedirect() {
Â  Â  if (isLoggingOut) return;
Â  Â  isLoggingOut = true;

Â  Â  try {
Â  Â  Â  Â  await fetch(`${API_URL}/logout`, {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  body: JSON.stringify({ id: username })
Â  Â  Â  Â  });
Â  Â  } catch (e) {
Â  Â  Â  Â  console.error("[LOGOUT] Erreur lors du /logout manuel (API):", e);
Â  Â  }
Â  Â  
Â  Â  // Supprimer le username et rediriger
Â  Â  localStorage.removeItem("username");
Â  Â  window.location.href = 'index.html';
}


/**
Â * Envoie une requÃªte /logout Ã  l'API de maniÃ¨re silencieuse (pour la fermeture de l'onglet).
Â */
function logoutSilently() {
Â  Â  if (!username || isLoggingOut) return;

Â  Â  const logoutData = JSON.stringify({ id: username });

Â  Â  if (navigator.sendBeacon) {
Â  Â  Â  Â  const blob = new Blob([logoutData], {type : 'application/json'});
Â  Â  Â  Â  navigator.sendBeacon(`${API_URL}/logout`, blob);
Â  Â  } else {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const xhr = new XMLHttpRequest();
Â  Â  Â  Â  Â  Â  xhr.open("POST", `${API_URL}/logout`, false); 
Â  Â  Â  Â  Â  Â  xhr.setRequestHeader("Content-Type", "application/json");
Â  Â  Â  Â  Â  Â  xhr.send(logoutData);
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error("[LOGOUT] Erreur lors du /logout silencieux (XHR):", e);
Â  Â  Â  Â  }
Â  Â  }
}

/**
Â * Fonction appelÃ©e lors de la tentative de fermeture ou de navigation.
Â */
function handleLogoutOnClose(event) {
Â  Â  if (isLoggingOut) return;
Â  Â  logoutSilently();
}

// -------------------------
// Ã‰VÃ‰NEMENT DE FERMETURE/QUITTER
// -------------------------
window.addEventListener('beforeunload', handleLogoutOnClose);


/* -------------------------
Â  Â ðŸŽ® AFFICHAGE DES CARTES
Â  Â ------------------------- */
const grid = document.getElementById("gameGrid");
const searchBar = document.getElementById("search_bar");

function displayGames(filteredGames) {
Â  Â  grid.innerHTML = "";
Â  Â  filteredGames.forEach(game => {
Â  Â  Â  Â  const card = document.createElement("div");
Â  Â  Â  Â  card.className = "card";

Â  Â  Â  Â  const gameLink = game.link ? game.link : "#";

Â  Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  Â  Â  <div class="card-image" style="background: ${game.color}">ðŸŽ®</div>
Â  Â  Â  Â  Â  Â  <div class="card-info">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="card-title">${game.title}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="card-genre">${game.genre}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="location.href='${gameLink}'" ${game.link ? "" : "disabled"}>â–¶ LANCER</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  Â  grid.appendChild(card);
Â  Â  });
}

// Affiche tous les jeux par dÃ©faut
displayGames(games);

// Filtrage en temps rÃ©el
searchBar.addEventListener("input", () => {
Â  Â  const searchText = searchBar.value.toLowerCase();
Â  Â  const filteredGames = games.filter(game => 
Â  Â  Â  Â  game.title.toLowerCase().startsWith(searchText)
Â  Â  );
Â  Â  displayGames(filteredGames);
});
</script>


</body>
</html>