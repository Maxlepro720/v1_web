<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Launcher</title>

<style>
* {
    box-sizing: border-box;
}

body { 
    margin: 0; 
    font-family: 'Segoe UI', Arial, sans-serif; 
    background: #0f1419; 
    color: white; 
}

/* HEADER - NOUVEAU STYLE GRADIENT */
header { 
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    display: flex; 
    align-items: center; 
    padding: 0 30px; 
    gap: 20px; 
    justify-content: space-between;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    border-bottom: 2px solid;
    border-image: linear-gradient(90deg, #e94560, #0f3460, #53599a) 1;
    position: relative;
    overflow: hidden;
    flex-wrap: wrap;
}

/* Effet de brillance animÃ© */
header::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(233, 69, 96, 0.1), transparent);
    animation: shimmer 3s infinite;
    pointer-events: none;
}

@keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
}

header h1 { 
    font-size: clamp(20px, 4vw, 28px); 
    margin: 0; 
    background: linear-gradient(135deg, #e94560, #ff6b9d, #c44569);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 800;
    letter-spacing: 1px;
    text-shadow: 0 0 30px rgba(233, 69, 96, 0.5);
    position: relative;
    z-index: 1;
    padding: 20px 0;
    white-space: nowrap;
}

/* NAV PRINCIPALE */
#main-nav { 
    display: flex; 
    align-items: center; 
    gap: 12px; 
    flex-grow: 1; 
    justify-content: flex-start;
    position: relative;
    z-index: 1;
    flex-wrap: wrap;
}

/* BOUTONS NAV - STYLE GLASSMORPHISM */
#main-nav button { 
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    color: white; 
    border: 1px solid rgba(255, 255, 255, 0.1);
    padding: 12px 20px; 
    cursor: pointer; 
    border-radius: 12px; 
    font-size: clamp(13px, 2vw, 15px);
    font-weight: 600;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    white-space: nowrap;
}

#main-nav button::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #e94560, #53599a);
    opacity: 0;
    transition: opacity 0.3s;
    z-index: -1;
}

#main-nav button:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(233, 69, 96, 0.3);
    border-color: #e94560;
}

#main-nav button:hover::before {
    opacity: 1;
}

/* BOUTON DÃ‰CONNEXION - STYLE NÃ‰ON */
#logout-button { 
    background: transparent;
    color: #ff4757; 
    border: 2px solid #ff4757;
    padding: 12px 20px; 
    cursor: pointer; 
    border-radius: 12px; 
    font-size: clamp(13px, 2vw, 15px); 
    font-weight: bold; 
    transition: all 0.3s;
    position: relative;
    z-index: 1;
    text-shadow: 0 0 10px rgba(255, 71, 87, 0.5);
    white-space: nowrap;
}

#logout-button:hover { 
    background: #ff4757;
    color: white;
    box-shadow: 0 0 30px rgba(255, 71, 87, 0.6), inset 0 0 20px rgba(255, 255, 255, 0.1);
    transform: translateY(-3px);
}

/* BARRE DE RECHERCHE - STYLE MODERNE */
#search_bar { 
    padding: 12px 20px; 
    border-radius: 25px; 
    border: 2px solid transparent;
    outline: none; 
    font-size: clamp(13px, 2vw, 15px); 
    background: linear-gradient(#1a1a2e, #1a1a2e) padding-box,
                linear-gradient(135deg, #e94560, #53599a) border-box;
    color: white; 
    transition: all 0.3s; 
    flex-grow: 1; 
    min-width: 150px;
    max-width: 350px;
}

#search_bar::placeholder { 
    color: #8892b0;
    font-style: italic;
}

#search_bar:focus { 
    background: linear-gradient(#16213e, #16213e) padding-box,
                linear-gradient(135deg, #ff6b9d, #e94560, #53599a) border-box;
    box-shadow: 0 0 25px rgba(233, 69, 96, 0.3);
}

/* SECTION */
.section-title { 
    font-size: clamp(22px, 5vw, 30px); 
    margin-left: 30px; 
    margin-top: 20px;
    background: linear-gradient(135deg, #e94560, #53599a);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* GRID */
.game-grid { 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(min(280px, 100%), 1fr)); 
    gap: 20px; 
    padding: 20px 30px; 
}

/* GAME CARD */
.card { 
    background: #1e293b; 
    border-radius: 8px; 
    overflow: hidden; 
    transition: 0.2s; 
}

.card:hover { 
    background: #2d3748; 
    transform: scale(1.02); 
}

.card-image { 
    height: 180px; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    font-size: clamp(50px, 10vw, 70px); 
    color: white; 
}

.card-info { 
    padding: 15px; 
}

.card-title { 
    font-size: clamp(16px, 3vw, 20px); 
    margin: 0; 
}

.card-genre { 
    font-size: clamp(12px, 2vw, 14px); 
    opacity: 0.7; 
    margin-top: 6px; 
    margin-bottom: 12px; 
}

.card button { 
    width: 100%; 
    background: #3b82f6; 
    border: none; 
    padding: 12px; 
    color: white; 
    cursor: pointer; 
    font-size: clamp(13px, 2vw, 15px); 
    border-radius: 6px; 
    transition: background 0.2s;
}

.card button:hover { 
    background: #2563eb; 
}

.card button:disabled {
    background: #4b5563;
    cursor: not-allowed;
}

/* =============================================
   MEDIA QUERIES - RESPONSIVE DESIGN
   ============================================= */

/* LARGE DESKTOP (1400px+) */
@media (min-width: 1400px) {
    header {
        padding: 0 50px;
    }
    
    .game-grid {
        padding: 20px 50px;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }
    
    .section-title {
        margin-left: 50px;
    }
}

/* TABLET LANDSCAPE (1024px - 1199px) */
@media (max-width: 1199px) {
    header {
        padding: 0 25px;
        gap: 15px;
    }
    
    #search_bar {
        max-width: 280px;
    }
}

/* TABLET PORTRAIT (768px - 1023px) */
@media (max-width: 1023px) {
    header {
        padding: 15px 20px;
        gap: 12px;
    }
    
    #main-nav {
        gap: 10px;
    }
    
    #main-nav button {
        padding: 10px 16px;
    }
    
    #logout-button {
        padding: 10px 16px;
    }
    
    #search_bar {
        max-width: 220px;
        min-width: 120px;
    }
    
    .game-grid {
        padding: 15px 20px;
        gap: 15px;
    }
    
    .section-title {
        margin-left: 20px;
    }
}

/* SMALL TABLET / LARGE PHONE (600px - 767px) */
@media (max-width: 767px) {
    header { 
        flex-direction: column; 
        align-items: stretch; 
        gap: 12px;
        padding: 15px;
    }
    
    header h1 {
        text-align: center;
        padding: 10px 0;
    }
    
    #main-nav { 
        flex-direction: row; 
        flex-wrap: wrap;
        width: 100%; 
        gap: 10px;
        justify-content: center;
    }

    #main-nav button {
        flex: 1;
        min-width: 120px;
        text-align: center; 
        padding: 12px 15px;
    }
    
    #search_bar {
        width: 100%;
        max-width: 100%;
        order: -1;
        padding: 12px 18px;
    }
    
    #logout-button {
        width: 100%;
        text-align: center;
        padding: 12px 18px;
    }

    .game-grid {
        grid-template-columns: repeat(auto-fit, minmax(min(250px, 100%), 1fr));
        padding: 15px;
        gap: 15px;
    }
    
    .section-title {
        margin-left: 15px;
        text-align: center;
        margin-left: 0;
    }
}

/* MOBILE (480px - 599px) */
@media (max-width: 599px) {
    header { 
        padding: 12px;
        gap: 10px;
    }
    
    header::before { 
        display: none; 
    }
    
    header h1 {
        font-size: 22px;
    }
    
    #main-nav { 
        flex-direction: column; 
        width: 100%; 
        gap: 8px;
    }

    #main-nav button {
        width: 100%;
        min-width: unset;
        padding: 12px 15px;
        border-radius: 10px;
    }
    
    #search_bar {
        padding: 12px 15px;
        border-radius: 15px;
        font-size: 14px;
    }
    
    #logout-button {
        padding: 12px 15px;
        border-radius: 10px;
    }

    .game-grid {
        grid-template-columns: 1fr;
        padding: 12px;
        gap: 12px;
    }
    
    .card-image {
        height: 150px;
    }
    
    .section-title {
        font-size: 22px;
        margin: 15px 12px;
    }
}

/* VERY SMALL MOBILE (< 480px) */
@media (max-width: 479px) {
    header {
        padding: 10px;
    }
    
    header h1 {
        font-size: 20px;
        padding: 8px 0;
    }
    
    #main-nav button {
        padding: 10px 12px;
        font-size: 14px;
    }
    
    #search_bar {
        padding: 10px 12px;
    }
    
    #logout-button {
        padding: 10px 12px;
        font-size: 14px;
    }
    
    .game-grid {
        padding: 10px;
        gap: 10px;
    }
    
    .card-info {
        padding: 12px;
    }
    
    .card-image {
        height: 130px;
    }
    
    .card button {
        padding: 10px;
    }
    
    .section-title {
        font-size: 20px;
        margin: 12px 10px;
    }
}
</style>
</head>
<body>

<header>
    <h1>ðŸŽ®  Accueil</h1>
    <nav id="main-nav">
        <button>ðŸ“š BibliothÃ¨que</button>
        <input id="search_bar" placeholder="ðŸ” Rechercher un jeu...">
        <button>ðŸ‘¥ Amis</button>
    </nav>
    <button id="logout-button" onclick="handleLogoutAndRedirect()">ðŸšª DÃ©connexion</button>
</header>

<h2 class="section-title">Ma BibliothÃ¨que</h2>

<div class="game-grid" id="gameGrid"></div>

<script>
const API_URL = "https://project-3-api-2bgb.onrender.com";

const games = [
    { id: 1, title: "Multiplayer Clicker", genre: "Clicker", link: "multiplayer_clicker.html", color: "#8b5cf6" },
    { id: 2, title: "Private Clicker", genre: "Clicker", link: "private_clicker.html", color: "#f97316" },
    { id: 3, title: "Coming Soon...", genre: "Not defined", link: "", color: "#06b6d4" },
    { id: 4, title: "Coming Soon...", genre: "Not defined", link: "", color: "#eab308" },
    { id: 5, title: "Coming Soon...", genre: "Not defined", link: "", color: "#14b8a6" },
    { id: 6, title: "Coming Soon...", genre: "Not defined", link: "", color: "#ec4899" }
];

const username = localStorage.getItem("username");
let isLoggingOut = false; 

if (!username) {
    // window.location.href = 'index.html';
}

async function handleLogoutAndRedirect() {
    if (isLoggingOut) return;
    isLoggingOut = true;
    try {
        await fetch(`${API_URL}/logout`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id: username })
        });
    } catch (e) {
        console.error("[LOGOUT] Erreur lors du /logout manuel (API):", e);
    }
    localStorage.removeItem("username");
    window.location.href = 'index.html';
}

function logoutSilently() {
    if (!username || isLoggingOut) return;
    const logoutData = JSON.stringify({ id: username });
    if (navigator.sendBeacon) {
        const blob = new Blob([logoutData], {type : 'application/json'});
        navigator.sendBeacon(`${API_URL}/logout`, blob);
    } else {
        try {
            const xhr = new XMLHttpRequest();
            xhr.open("POST", `${API_URL}/logout`, false); 
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.send(logoutData);
        } catch (e) {
            console.error("[LOGOUT] Erreur lors du /logout silencieux (XHR):", e);
        }
    }
}

function handleLogoutOnClose(event) {
    if (isLoggingOut) return;
    logoutSilently();
}

window.addEventListener('beforeunload', handleLogoutOnClose);

const grid = document.getElementById("gameGrid");
const searchBar = document.getElementById("search_bar");

function displayGames(filteredGames) {
    grid.innerHTML = "";
    filteredGames.forEach(game => {
        const card = document.createElement("div");
        card.className = "card";
        const gameLink = game.link ? game.link : "#";
        card.innerHTML = `
            <div class="card-image" style="background: ${game.color}">ðŸŽ®</div>
            <div class="card-info">
                <h3 class="card-title">${game.title}</h3>
                <p class="card-genre">${game.genre}</p>
                <button onclick="location.href='${gameLink}'" ${game.link ? "" : "disabled"}>â–¶ LANCER</button>
            </div>
        `;
        grid.appendChild(card);
    });
}

displayGames(games);

searchBar.addEventListener("input", () => {
    const searchText = searchBar.value.toLowerCase();
    const filteredGames = games.filter(game => 
        game.title.toLowerCase().startsWith(searchText)
    );
    displayGames(filteredGames);
});
</script>

</body>
</html>