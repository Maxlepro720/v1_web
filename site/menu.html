<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Launcher</title>

<style>
/* -------------------------
Â  Â  ðŸŽ¨ STYLES CSS
Â  Â  ------------------------- */
Â  Â  body { margin: 0; font-family: Arial, sans-serif; background: #0f1419; color: white; }

Â  Â  /* HEADER */
Â  Â  header { background: black; display: flex; align-items: center; padding: 20px 30px; gap: 20px; justify-content: space-between; }
Â  Â  header h1 { font-size: 26px; color: #60a5fa; margin: 0; }
    #main-nav { display: flex; align-items: center; gap: 10px; }
    
Â  Â  #main-nav button { background: #1f2937; color: white; border: none; padding: 12px 20px; cursor: pointer; border-radius: 6px; font-size: 15px; }
Â  Â  #main-nav button:hover { background: #374151; }

    /* Style spÃ©cifique pour le bouton de dÃ©connexion (compactÃ©) */
    #logout-button { background: #ef4444; color: white; border: none; padding: 12px 20px; cursor: pointer; border-radius: 6px; font-size: 15px; font-weight: bold; margin-left: 20px; transition: background 0.2s; }
    #logout-button:hover { background: #dc2626; }


Â  Â  /* Barre de recherche stylisÃ©e comme un bouton */
Â  Â  #search_bar { padding: 12px 20px; border-radius: 6px; border: none; outline: none; font-size: 15px; background: #1f2937; color: white; transition: background 0.2s; }
Â  Â  #search_bar::placeholder { color: #d1d5db; }
Â  Â  #search_bar:focus { background: #374151; }

Â  Â  /* SECTION */
Â  Â  .section-title { font-size: 30px; margin-left: 30px; margin-top: 20px; }

Â  Â  /* GRID */
Â  Â  .game-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; padding: 20px 30px; }

Â  Â  /* GAME CARD */
Â  Â  .card { background: #1e293b; border-radius: 8px; overflow: hidden; transition: 0.2s; }
Â  Â  .card:hover { background: #2d3748; transform: scale(1.02); }
Â  Â  .card-image { height: 180px; display: flex; align-items: center; justify-content: center; font-size: 70px; color: white; }
Â  Â  .card-info { padding: 15px; }
Â  Â  .card-title { font-size: 20px; margin: 0; }
Â  Â  .card-genre { font-size: 14px; opacity: 0.7; margin-top: 6px; margin-bottom: 12px; }
Â  Â  .card button { width: 100%; background: #3b82f6; border: none; padding: 12px; color: white; cursor: pointer; font-size: 15px; border-radius: 6px; }
Â  Â  .card button:hover { background: #2563eb; }
</style>
</head>
<body>

<header>
Â  Â  <h1>ðŸŽ® Â Accueil</h1>
    <nav id="main-nav">
Â  Â  Â  Â  <button>ðŸ“š BibliothÃ¨que</button>
Â  Â  Â  Â  <input id="search_bar" placeholder="Rechercher">
Â  Â  Â  Â  <button>ðŸ‘¥ Amis</button>
        
        <button id="logout-button" onclick="handleLogoutAndRedirect()">ðŸšª DÃ©connexion</button>
Â  Â  </nav>
</header>

<h2 class="section-title">Ma BibliothÃ¨que</h2>

<div class="game-grid" id="gameGrid"></div>

<script>
const API_URL = "https://project-3-api-2bgb.onrender.com";

/* -------------------------
Â  Â ðŸ“¦ LISTE DES JEUX
Â  Â ------------------------- */
const games = [
Â  Â  { id: 1, title: "Multiplayer Clicker", genre: "Clicker", link: "multiplayer_clicker.html", color: "#8b5cf6" },
Â  Â  { id: 2, title: "Private Clicker", genre: "Clicker", link: "private_clicker.html", color: "#f97316" },
Â  Â  { id: 3, title: "Coming Soon...", genre: "Not defined", link: "", color: "#06b6d4" },
Â  Â  { id: 4, title: "Coming Soon...", genre: "Not defined", link: "", color: "#eab308" },
Â  Â  { id: 5, title: "Coming Soon...", genre: "Not defined", link: "", color: "#14b8a6" },
Â  Â  { id: 6, title: "Coming Soon...", genre: "Not defined", link: "", color: "#ec4899" }
];

/* -------------------------
Â  Â ðŸ§‘â€ðŸ’» RÃ‰CUPÃ‰RATION ET VÃ‰RIFICATION DU USERNAME
Â  Â ------------------------- */
const username = localStorage.getItem("username");
let isLoggingOut = false; // Variable pour Ã©viter les doubles dÃ©connexions

if (!username) {
Â  Â  // Si l'utilisateur n'est pas identifiÃ©, on le renvoie Ã  la page de connexion
Â  Â  window.location.href = 'index.html';
}

/* -------------------------------------
Â  Â ðŸš¨ GESTION DE LA DÃ‰CONNEXION (LOGOUT)
Â  Â ------------------------------------- */

/**
 * GÃ¨re le logout initiÃ© par l'utilisateur (bouton).
 * Effectue le /logout API et redirige vers index.html.
 */
async function handleLogoutAndRedirect() {
    if (isLoggingOut) return;
    isLoggingOut = true;

    try {
        console.log("[LOGOUT] DÃ©connexion utilisateur manuelle...");
        await fetch(`${API_URL}/logout`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id: username })
        });
    } catch (e) {
        console.error("[LOGOUT] Erreur lors du /logout manuel (API):", e);
    }
    
    // Supprimer le username et rediriger
    localStorage.removeItem("username");
    window.location.href = 'index.html';
}


/**
Â * Envoie une requÃªte /logout Ã  l'API de maniÃ¨re silencieuse (pour la fermeture de l'onglet).
Â */
function logoutSilently() {
Â  Â  if (!username || isLoggingOut) return;

Â  Â  const logoutData = JSON.stringify({ id: username });

Â  Â  // Utilisation de sendBeacon (mÃ©thode privilÃ©giÃ©e lors de la fermeture)
Â  Â  if (navigator.sendBeacon) {
Â  Â  Â  Â  console.log("[LOGOUT] Tentative de dÃ©connexion via sendBeacon (fermeture d'onglet)...");
Â  Â  Â  Â  const blob = new Blob([logoutData], {type : 'application/json'});
Â  Â  Â  Â  navigator.sendBeacon(`${API_URL}/logout`, blob);
Â  Â  } else {
Â  Â  Â  Â  // Fallback XHR synchrone (moins fiable et dÃ©conseillÃ©)
Â  Â  Â  Â  console.warn("[LOGOUT] sendBeacon non disponible, utilisation de XHR synchrone.");
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const xhr = new XMLHttpRequest();
Â  Â  Â  Â  Â  Â  xhr.open("POST", `${API_URL}/logout`, false); // false = synchrone
Â  Â  Â  Â  Â  Â  xhr.setRequestHeader("Content-Type", "application/json");
Â  Â  Â  Â  Â  Â  xhr.send(logoutData);
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error("[LOGOUT] Erreur lors du /logout silencieux (XHR):", e);
Â  Â  Â  Â  }
Â  Â  }
}

/**
Â * Fonction appelÃ©e lors de la tentative de fermeture ou de navigation.
Â */
function handleLogoutOnClose(event) {
    if (isLoggingOut) return; // Si la dÃ©connexion est dÃ©jÃ  en cours via le bouton, on ne fait rien.
Â  Â  // Appel de la dÃ©connexion silencieuse pour marquer l'utilisateur comme dÃ©connectÃ©.
Â  Â  logoutSilently();
}

// -------------------------
// Ã‰VÃ‰NEMENT DE FERMETURE/QUITTER
// -------------------------
window.addEventListener('beforeunload', handleLogoutOnClose);


/* -------------------------
Â  Â ðŸŽ® AFFICHAGE DES CARTES
Â  Â ------------------------- */
const grid = document.getElementById("gameGrid");
const searchBar = document.getElementById("search_bar");

function displayGames(filteredGames) {
Â  Â  grid.innerHTML = "";
Â  Â  filteredGames.forEach(game => {
Â  Â  Â  Â  const card = document.createElement("div");
Â  Â  Â  Â  card.className = "card";

Â  Â  Â  Â  const gameLink = game.link ? game.link : "#";

Â  Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  Â  Â  <div class="card-image" style="background: ${game.color}">ðŸŽ®</div>
Â  Â  Â  Â  Â  Â  <div class="card-info">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="card-title">${game.title}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="card-genre">${game.genre}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="location.href='${gameLink}'" ${game.link ? "" : "disabled"}>â–¶ LANCER</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  Â  grid.appendChild(card);
Â  Â  });
}

// Affiche tous les jeux par dÃ©faut
displayGames(games);

// Filtrage en temps rÃ©el
searchBar.addEventListener("input", () => {
Â  Â  const searchText = searchBar.value.toLowerCase();
Â  Â  const filteredGames = games.filter(game => 
Â  Â  Â  Â  game.title.toLowerCase().startsWith(searchText)
Â  Â  );
Â  Â  displayGames(filteredGames);
});
</script>


</body>
</html>